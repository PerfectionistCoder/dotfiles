let emacs_keybinds = [
  {
      "mode": "emacs"
      "modifier": "none"
      "keycode": "Backspace"
      "event": null
  }
  {
      "mode": "emacs"
      "modifier": "none"
      "keycode": "Delete"
      "event": null
  }
  {
      "mode": "emacs"
      "modifier": "none"
      "keycode": "Down"
      "event": null
  }
  {
      "mode": "emacs"
      "modifier": "none"
      "keycode": "End"
      "event": null
  }
  {
      "mode": "emacs"
      "modifier": "none"
      "keycode": "Enter"
      "event": null
  }
  {
      "mode": "emacs"
      "modifier": "none"
      "keycode": "Esc"
      "event": null
  }
  {
      "mode": "emacs"
      "modifier": "none"
      "keycode": "Home"
      "event": null
  }
  {
      "mode": "emacs"
      "modifier": "none"
      "keycode": "Left"
      "event": null
  }
  {
      "mode": "emacs"
      "modifier": "none"
      "keycode": "Right"
      "event": null
  }
  {
      "mode": "emacs"
      "modifier": "none"
      "keycode": "Up"
      "event": null
  }
  {
      "mode": "emacs"
      "modifier": "alt"
      "keycode": "Backspace"
      "event": null
  }
  {
      "mode": "emacs"
      "modifier": "alt"
      "keycode": "Char_b"
      "event": null
  }
  {
      "mode": "emacs"
      "modifier": "alt"
      "keycode": "Char_c"
      "event": null
  }
  {
      "mode": "emacs"
      "modifier": "alt"
      "keycode": "Char_d"
      "event": null
  }
  {
      "mode": "emacs"
      "modifier": "alt"
      "keycode": "Char_f"
      "event": null
  }
  {
      "mode": "emacs"
      "modifier": "alt"
      "keycode": "Char_l"
      "event": null
  }
  {
      "mode": "emacs"
      "modifier": "alt"
      "keycode": "Char_m"
      "event": null
  }
  {
      "mode": "emacs"
      "modifier": "alt"
      "keycode": "Char_u"
      "event": null
  }
  {
      "mode": "emacs"
      "modifier": "alt"
      "keycode": "Delete"
      "event": null
  }
  {
      "mode": "emacs"
      "modifier": "alt"
      "keycode": "Enter"
      "event": null
  }
  {
      "mode": "emacs"
      "modifier": "alt"
      "keycode": "Left"
      "event": null
  }
  {
      "mode": "emacs"
      "modifier": "alt"
      "keycode": "Right"
      "event": null
  }
  {
      "mode": "emacs"
      "modifier": "control"
      "keycode": "Backspace"
      "event": null
  }
  {
      "mode": "emacs"
      "modifier": "control"
      "keycode": "Char_a"
      "event": null
  }
  {
      "mode": "emacs"
      "modifier": "control"
      "keycode": "Char_b"
      "event": null
  }
  {
      "mode": "emacs"
      "modifier": "control"
      "keycode": "Char_c"
      "event": null
  }
  {
      "mode": "emacs"
      "modifier": "control"
      "keycode": "Char_d"
      "event": null
  }
  {
      "mode": "emacs"
      "modifier": "control"
      "keycode": "Char_e"
      "event": null
  }
  {
      "mode": "emacs"
      "modifier": "control"
      "keycode": "Char_f"
      "event": null
  }
  {
      "mode": "emacs"
      "modifier": "control"
      "keycode": "Char_g"
      "event": null
  }
  {
      "mode": "emacs"
      "modifier": "control"
      "keycode": "Char_h"
      "event": null
  }
  {
      "mode": "emacs"
      "modifier": "control"
      "keycode": "Char_j"
      "event": null
  }
  {
      "mode": "emacs"
      "modifier": "control"
      "keycode": "Char_k"
      "event": null
  }
  {
      "mode": "emacs"
      "modifier": "control"
      "keycode": "Char_l"
      "event": null
  }
  {
      "mode": "emacs"
      "modifier": "control"
      "keycode": "Char_n"
      "event": null
  }
  {
      "mode": "emacs"
      "modifier": "control"
      "keycode": "Char_o"
      "event": null
  }
  {
      "mode": "emacs"
      "modifier": "control"
      "keycode": "Char_p"
      "event": null
  }
  {
      "mode": "emacs"
      "modifier": "control"
      "keycode": "Char_r"
      "event": null
  }
  {
      "mode": "emacs"
      "modifier": "control"
      "keycode": "Char_t"
      "event": null
  }
  {
      "mode": "emacs"
      "modifier": "control"
      "keycode": "Char_u"
      "event": null
  }
  {
      "mode": "emacs"
      "modifier": "control"
      "keycode": "Char_w"
      "event": null
  }
  {
      "mode": "emacs"
      "modifier": "control"
      "keycode": "Char_y"
      "event": null
  }
  {
      "mode": "emacs"
      "modifier": "control"
      "keycode": "Char_z"
      "event": null
  }
  {
      "mode": "emacs"
      "modifier": "control"
      "keycode": "Delete"
      "event": null
  }
  {
      "mode": "emacs"
      "modifier": "control"
      "keycode": "End"
      "event": null
  }
  {
      "mode": "emacs"
      "modifier": "control"
      "keycode": "Home"
      "event": null
  }
  {
      "mode": "emacs"
      "modifier": "control"
      "keycode": "Left"
      "event": null
  }
  {
      "mode": "emacs"
      "modifier": "control"
      "keycode": "Right"
      "event": null
  }
  {
      "mode": "emacs"
      "modifier": "control_shift"
      "keycode": "Char_a"
      "event": null
  }
  {
      "mode": "emacs"
      "modifier": "control_shift"
      "keycode": "End"
      "event": null
  }
  {
      "mode": "emacs"
      "modifier": "control_shift"
      "keycode": "Home"
      "event": null
  }
  {
      "mode": "emacs"
      "modifier": "control_shift"
      "keycode": "Left"
      "event": null
  }
  {
      "mode": "emacs"
      "modifier": "control_shift"
      "keycode": "Right"
      "event": null
  }
  {
      "mode": "emacs"
      "modifier": "shift"
      "keycode": "End"
      "event": null
  }
  {
      "mode": "emacs"
      "modifier": "shift"
      "keycode": "Enter"
      "event": null
  }
  {
      "mode": "emacs"
      "modifier": "shift"
      "keycode": "Home"
      "event": null
  }
  {
      "mode": "emacs"
      "modifier": "shift"
      "keycode": "Left"
      "event": null
  }
  {
      "mode": "emacs"
      "modifier": "shift"
      "keycode": "Right"
      "event": null
  }
]
# let vi_keybinds = [
#   {
#       "mode": "vi_normal"
#       "modifier": "none"
#       "keycode": "Backspace"
#       "event": null
#   }
#   {
#       "mode": "vi_normal"
#       "modifier": "none"
#       "keycode": "Delete"
#       "event": null
#   }
#   {
#       "mode": "vi_normal"
#       "modifier": "none"
#       "keycode": "Down"
#       "event": null
#   }
#   {
#       "mode": "vi_normal"
#       "modifier": "none"
#       "keycode": "End"
#       "event": null
#   }
#   {
#       "mode": "vi_normal"
#       "modifier": "none"
#       "keycode": "Esc"
#       "event": null
#   }
#   {
#       "mode": "vi_normal"
#       "modifier": "none"
#       "keycode": "Home"
#       "event": null
#   }
#   {
#       "mode": "vi_normal"
#       "modifier": "none"
#       "keycode": "Left"
#       "event": null
#   }
#   {
#       "mode": "vi_normal"
#       "modifier": "none"
#       "keycode": "Right"
#       "event": null
#   }
#   {
#       "mode": "vi_normal"
#       "modifier": "none"
#       "keycode": "Up"
#       "event": null
#   }
#   {
#       "mode": "vi_normal"
#       "modifier": "control"
#       "keycode": "Char_a"
#       "event": null
#   }
#   {
#       "mode": "vi_normal"
#       "modifier": "control"
#       "keycode": "Char_c"
#       "event": null
#   }
#   {
#       "mode": "vi_normal"
#       "modifier": "control"
#       "keycode": "Char_d"
#       "event": null
#   }
#   {
#       "mode": "vi_normal"
#       "modifier": "control"
#       "keycode": "Char_e"
#       "event": null
#   }
#   {
#       "mode": "vi_normal"
#       "modifier": "control"
#       "keycode": "Char_l"
#       "event": null
#   }
#   {
#       "mode": "vi_normal"
#       "modifier": "control"
#       "keycode": "Char_n"
#       "event": null
#   }
#   {
#       "mode": "vi_normal"
#       "modifier": "control"
#       "keycode": "Char_o"
#       "event": null
#   }
#   {
#       "mode": "vi_normal"
#       "modifier": "control"
#       "keycode": "Char_p"
#       "event": null
#   }
#   {
#       "mode": "vi_normal"
#       "modifier": "control"
#       "keycode": "Char_r"
#       "event": null
#   }
#   {
#       "mode": "vi_normal"
#       "modifier": "control"
#       "keycode": "End"
#       "event": null
#   }
#   {
#       "mode": "vi_normal"
#       "modifier": "control"
#       "keycode": "Home"
#       "event": null
#   }
#   {
#       "mode": "vi_normal"
#       "modifier": "control"
#       "keycode": "Left"
#       "event": null
#   }
#   {
#       "mode": "vi_normal"
#       "modifier": "control"
#       "keycode": "Right"
#       "event": null
#   }
#   {
#     "mode": "vi_normal"
#     "modifier": "control_shift"
#     "keycode": "Char_a"
#     "event": null
#   }
#   {
#     "mode": "vi_normal"
#     "modifier": "control_shift"
#     "keycode": "End"
#     "event": null
#   }
#   {
#     "mode": "vi_normal"
#     "modifier": "control_shift"
#     "keycode": "Home"
#     "event": null
#   }
#   {
#     "mode": "vi_normal"
#     "modifier": "control_shift"
#     "keycode": "Left"
#     "event": null
#   }
#   {
#     "mode": "vi_normal"
#     "modifier": "control_shift"
#     "keycode": "Right"
#     "event": null
#   }
#   {
#     "mode": "vi_normal"
#     "modifier": "shift"
#     "keycode": "End"
#     "event": null
#   }
#   {
#     "mode": "vi_normal"
#     "modifier": "shift"
#     "keycode": "Home"
#     "event": null
#   }
#   {
#     "mode": "vi_normal"
#     "modifier": "shift"
#     "keycode": "Left"
#     "event": null
#   }
#   {
#     "mode": "vi_normal"
#     "modifier": "shift"
#     "keycode": "Right"
#     "event": null
#   }
#   {
#     "mode": "vi_insert"
#     "modifier": "none"
#     "keycode": "Backspace"
#     "event": null
#   }
#   {
#     "mode": "vi_insert"
#     "modifier": "none"
#     "keycode": "Delete"
#     "event": null
#   }
#   {
#     "mode": "vi_insert"
#     "modifier": "none"
#     "keycode": "Down"
#     "event": null
#   }
#   {
#     "mode": "vi_insert"
#     "modifier": "none"
#     "keycode": "End"
#     "event": null
#   }
#   {
#     "mode": "vi_insert"
#     "modifier": "none"
#     "keycode": "Esc"
#     "event": null
#   }
#   {
#     "mode": "vi_insert"
#     "modifier": "none"
#     "keycode": "Home"
#     "event": null
#   }
#   {
#     "mode": "vi_insert"
#     "modifier": "none"
#     "keycode": "Left"
#     "event": null
#   }
#   {
#     "mode": "vi_insert"
#     "modifier": "none"
#     "keycode": "Right"
#     "event": null
#   }
#   {
#     "mode": "vi_insert"
#     "modifier": "none"
#     "keycode": "Up"
#     "event": null
#   }
#   {
#     "mode": "vi_insert"
#     "modifier": "alt"
#     "keycode": "Enter"
#     "event": null
#   }
#   {
#     "mode": "vi_insert"
#     "modifier": "control"
#     "keycode": "Backspace"
#     "event": null
#   }
#   {
#     "mode": "vi_insert"
#     "modifier": "control"
#     "keycode": "Char_a"
#     "event": null
#   }
#   {
#     "mode": "vi_insert"
#     "modifier": "control"
#     "keycode": "Char_c"
#     "event": null
#   }
#   {
#     "mode": "vi_insert"
#     "modifier": "control"
#     "keycode": "Char_d"
#     "event": null
#   }
#   {
#     "mode": "vi_insert"
#     "modifier": "control"
#     "keycode": "Char_e"
#     "event": null
#   }
#   {
#     "mode": "vi_insert"
#     "modifier": "control"
#     "keycode": "Char_h"
#     "event": null
#   }
#   {
#     "mode": "vi_insert"
#     "modifier": "control"
#     "keycode": "Char_j"
#     "event": null
#   }
#   {
#     "mode": "vi_insert"
#     "modifier": "control"
#     "keycode": "Char_l"
#     "event": null
#   }
#   {
#     "mode": "vi_insert"
#     "modifier": "control"
#     "keycode": "Char_n"
#     "event": null
#   }
#   {
#     "mode": "vi_insert"
#     "modifier": "control"
#     "keycode": "Char_o"
#     "event": null
#   }
#   {
#     "mode": "vi_insert"
#     "modifier": "control"
#     "keycode": "Char_p"
#     "event": null
#   }
#   {
#     "mode": "vi_insert"
#     "modifier": "control"
#     "keycode": "Char_r"
#     "event": null
#   }
#   {
#     "mode": "vi_insert"
#     "modifier": "control"
#     "keycode": "Char_w"
#     "event": null
#   }
#   {
#     "mode": "vi_insert"
#     "modifier": "control"
#     "keycode": "Delete"
#     "event": null
#   }
#   {
#     "mode": "vi_insert"
#     "modifier": "control"
#     "keycode": "End"
#     "event": null
#   }
#   {
#     "mode": "vi_insert"
#     "modifier": "control"
#     "keycode": "Home"
#     "event": null
#   }
#   {
#     "mode": "vi_insert"
#     "modifier": "control"
#     "keycode": "Left"
#     "event": null
#   }
#   {
#     "mode": "vi_insert"
#     "modifier": "control"
#     "keycode": "Right"
#     "event": null
#   }
#   {
#     "mode": "vi_insert"
#     "modifier": "control_shift"
#     "keycode": "Char_a"
#     "event": null
#   }
#   {
#     "mode": "vi_insert"
#     "modifier": "control_shift"
#     "keycode": "End"
#     "event": null
#   }
#   {
#     "mode": "vi_insert"
#     "modifier": "control_shift"
#     "keycode": "Home"
#     "event": null
#   }
#   {
#     "mode": "vi_insert"
#     "modifier": "control_shift"
#     "keycode": "Left"
#     "event": null
#   }
#   {
#     "mode": "vi_insert"
#     "modifier": "control_shift"
#     "keycode": "Right"
#     "event": null
#   }
#   {
#     "mode": "vi_insert"
#     "modifier": "shift"
#     "keycode": "End"
#     "event": null
#   }
#   {
#     "mode": "vi_insert"
#     "modifier": "shift"
#     "keycode": "Enter"
#     "event": null
#   }
#   {
#     "mode": "vi_insert"
#     "modifier": "shift"
#     "keycode": "Home"
#     "event": null
#   }
#   {
#     "mode": "vi_insert"
#     "modifier": "shift"
#     "keycode": "Left"
#     "event": null
#   }
#   {
#     "mode": "vi_insert"
#     "modifier": "shift"
#     "keycode": "Right"
#     "event": null
#   }
# ]
let common_keybinds = [
  {
    "mode": "emacs"
    "modifier": "none"
    "keycode": "Tab"
    "event": null
  }
  {
    "mode": "emacs"
    "modifier": "shift"
    "keycode": "BackTab"
    "event": null
  }
  {
    "mode": "emacs"
    "modifier": "none"
    "keycode": "F1"
    "event": null
  }
]

let keybinds = [
  # arrow keys
  {
    "keycode": "Up"
    "event": {
      until: [
        { send: MenuUp }
        { send: Up }
      ]
    }
  }
  {
    "keycode": "Down"
    "event": {
      until: [
        { send: MenuDown }
        { send: Down }
      ]
    }
  }
  {
    "keycode": "Left"
    "event": {
      until: [
        { send: MenuLeft }
        { send: Left }
      ]
    }
  }
  {
    "keycode": "Right"
    "event": {
      until: [
        { send: MenuRight }
        { send: Right }
      ]
    }
  }
  {
    "modifier": "control"
    "keycode": "Left"
    "event": { edit: MoveWordLeft }
  }
  {
    "modifier": "control"
    "keycode": "Right"
    "event": {
      until: [
        { send: HistoryHintWordComplete }
        { edit: MoveWordRight }
      ]
    }
  }
  {
    "modifier": "shift"
    "keycode": "Left"
    "event": { edit: MoveLeft select: true }
  }
  {
    "modifier": "shift"
    "keycode": "Right"
    "event": { edit: MoveRight select: true }
  }
  {
    "modifier": "control_shift"
    "keycode": "Left"
    "event": { edit: MoveWordLeft select: true }
  }
  {
    "modifier": "control_shift"
    "keycode": "Right"
    "event": { edit: MoveWordRight select: true }
  }

  # home end
  {
    "keycode": "Home"
    "event": { edit: MoveToLineStart }
  }
  {
    "keycode": "End"
    "event": { edit: MoveToLineEnd }
  }
  {
    "modifier": "shift"
    "keycode": "Home"
    "event": { edit: MoveToLineStart select: true }
  }
  {
    "modifier": "shift"
    "keycode": "End"
    "event": { edit: MoveToLineEnd select: true }
  }

  # copy & paste
  {
    "modifier": "control"
    "keycode": "Char_c"
    "event": { edit: CopySelection }
  }
  {
    "modifier": "control"
    "keycode": "Char_x"
    "event": { edit: CutSelection }
  }
  {
    "modifier": "control"
    "keycode": "Char_v"
    "event": { edit: Paste }
  }

  # backspace
  {
    "keycode": "Backspace"
    "event": { edit: Backspace }
  }
  {
    "modifier": "control"
    "keycode": "Backspace"
    "event": { edit: BackspaceWord }
  }
  {
    "keycode": "Delete"
    "event": { edit: Delete }
  }
  {
    "modifier": "control"
    "keycode": "Delete"
    "event": { edit: DeleteWord }
  }

  # undo & redo
  {
    "modifier": "control"
    "keycode": "Char_z"
    "event": { edit: Undo }
  }
  {
    "modifier": "control_shift"
    "keycode": "Char_z"
    "event": { edit: Redo }
  }

  # completion
  {
    "keycode": "Tab"
    "event": {
      until: [
        {
          send: HistoryHintComplete
        }
        {
          send: menu 
          name: completion_menu
        }
        {
          send: Submit
        }
      ]
    }
  }
  {
    "modifier": "shift"
    "keycode": "BackTab"
    "event": { send: menu name: completion_menu }
  }
  {
    "modifier": "control"
    "keycode": "Tab"
    "event": { send: menu name: history_menu }
  }

  # misc
  {
    "keycode": "Enter"
    "event": { send: Enter }
  }
  {
    "keycode": "Esc"
    "event": { send: Esc }
  }
  {
    "modifier": "control"
    "keycode": "Char_k"
    "event": { send: CtrlC }
  }
  {
    "modifier": "control"
    "keycode": "Char_l"
    "event": [
      { send: ClearScreen }
      { send: ClearScrollback }
    ]
  }
] | each {|kb| { "modifier": "none" "mode": "emacs" } | merge $kb}
$env.config.keybindings = $emacs_keybinds ++ $common_keybinds ++ $keybinds